<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-devtool/memory">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">内存（Memory） | iiLsss</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://iilsss.github.io//docs/devtool/memory"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="内存（Memory） | iiLsss"><meta data-rh="true" name="description" content="在 Chrome 浏览器的开发者工具（DevTools）中，内存（Memory） 标签页用于分析和调试内存相关的问题。拍摄堆快照（Heap Snapshot）后，堆快照的表格中包含多个列，其中 构造函数（Constructor）、距离（Distance）、浅层大小（Shallow Size） 和 保留大小（Retained Size） 是关键的指标。以下是对这些表头的详细解释："><meta data-rh="true" property="og:description" content="在 Chrome 浏览器的开发者工具（DevTools）中，内存（Memory） 标签页用于分析和调试内存相关的问题。拍摄堆快照（Heap Snapshot）后，堆快照的表格中包含多个列，其中 构造函数（Constructor）、距离（Distance）、浅层大小（Shallow Size） 和 保留大小（Retained Size） 是关键的指标。以下是对这些表头的详细解释："><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://iilsss.github.io//docs/devtool/memory"><link data-rh="true" rel="alternate" href="https://iilsss.github.io//docs/devtool/memory" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://iilsss.github.io//docs/devtool/memory" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="iiLsss RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="iiLsss Atom Feed"><link rel="stylesheet" href="/assets/css/styles.28aaf335.css">
<link rel="preload" href="/assets/js/runtime~main.61b4b5da.js" as="script">
<link rel="preload" href="/assets/js/main.66584053.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">地球</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro/">Note</a><a class="navbar__item navbar__link header-react-link" href="/docs/react/">React</a><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">More</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/interview/">📙 知识体系</a></li><li><a class="dropdown__link" href="/tool">🛠️ 工具</a></li></ul></div><a href="https://github.com/iiLsss/iiLsss.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>内存（Memory）</h1><p>在 Chrome 浏览器的开发者工具（DevTools）中，<strong>内存（Memory）</strong> 标签页用于分析和调试内存相关的问题。拍摄堆快照（Heap Snapshot）后，堆快照的表格中包含多个列，其中 <strong>构造函数（Constructor）</strong>、<strong>距离（Distance）</strong>、<strong>浅层大小（Shallow Size）</strong> 和 <strong>保留大小（Retained Size）</strong> 是关键的指标。以下是对这些表头的详细解释：</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-堆快照表格含义">1. 堆快照表格含义<a class="hash-link" href="#1-堆快照表格含义" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-构造函数constructor">1. 构造函数（Constructor）<a class="hash-link" href="#1-构造函数constructor" title="标题的直接链接">​</a></h3><p><strong>定义</strong>：</p><ul><li><strong>构造函数</strong> 列显示的是创建对象的构造器函数或类的名称。</li></ul><p><strong>作用</strong>：</p><ul><li>帮助开发者了解特定对象是由哪个构造函数或类实例化的，从而快速定位代码中相关的部分。</li><li>例如，一个由 <code>Array</code> 构造函数创建的对象会在这一列显示为 <code>Array</code>。</li></ul><p><strong>示例</strong>：
| 构造函数 | ... |
|---------|-----|
| Array   | ... |
| Object  | ... |
| MyClass | ... |</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-距离distance">2. 距离（Distance）<a class="hash-link" href="#2-距离distance" title="标题的直接链接">​</a></h3><p><strong>定义</strong>：</p><ul><li><strong>距离</strong> 表示从 <strong>根对象（Roots）</strong> 到当前对象的引用链长度，即对象被引用的“距离”。</li></ul><p><strong>作用</strong>：</p><ul><li>距离越小，表示对象更接近根对象，通常意味着它更容易被访问和保留在内存中。</li><li>距离较大的对象可能通过较长的引用链被保留，通常与内存泄漏相关。</li></ul><p><strong>解释</strong>：</p><ul><li>距离为 0：表示该对象是根对象之一（如全局对象 <code>window</code>）。</li><li>距离为 1：表示该对象直接由根对象引用。</li><li>距离为 n：表示需要经过 n 步引用才能到达该对象。</li></ul><p><strong>示例</strong>：
| 距离 | ... |
|-----|-----|
| 0   | ... |
| 2   | ... |
| 5   | ... |</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-浅层大小shallow-size">3. 浅层大小（Shallow Size）<a class="hash-link" href="#3-浅层大小shallow-size" title="标题的直接链接">​</a></h3><p><strong>定义</strong>：</p><ul><li><strong>浅层大小</strong> 指的是对象本身在内存中占用的空间，不包括它引用的其他对象所占用的内存。</li></ul><p><strong>作用</strong>：</p><ul><li>帮助开发者了解单个对象本身的内存消耗。</li><li>用于识别内存占用较大的对象类型，优化单个对象的内存使用。</li></ul><p><strong>解释</strong>：</p><ul><li>如果一个对象包含对其他对象的引用，这些引用所占用的内存不计入浅层大小。</li></ul><p><strong>示例</strong>：
| 浅层大小 | ... |
|---------|-----|
| 24 KB   | ... |
| 8 KB    | ... |
| 16 KB   | ... |</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-保留大小retained-size">4. 保留大小（Retained Size）<a class="hash-link" href="#4-保留大小retained-size" title="标题的直接链接">​</a></h3><p><strong>定义</strong>：</p><ul><li><strong>保留大小</strong> 表示如果该对象被垃圾回收（GC）释放，能够被释放的所有内存的总和，包括该对象本身和它引用的所有对象。</li></ul><p><strong>作用</strong>：</p><ul><li>帮助识别哪些对象的释放将带来最大的内存回收量。</li><li>通过优化保留大小较大的对象，可以有效减少内存使用，防止内存泄漏。</li></ul><p><strong>解释</strong>：</p><ul><li>保留大小包括对象本身的浅层大小以及所有通过引用链被该对象持有的对象的浅层大小。</li></ul><p><strong>示例</strong>：
| 保留大小 | ... |
|---------|-----|
| 100 KB  | ... |
| 50 KB   | ... |
| 200 KB  | ... |</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="综合示例"><strong>综合示例</strong><a class="hash-link" href="#综合示例" title="标题的直接链接">​</a></h3><p>假设堆快照表格如下：</p><table><thead><tr><th>构造函数</th><th>距离</th><th>浅层大小</th><th>保留大小</th></tr></thead><tbody><tr><td>Array</td><td>2</td><td>24 KB</td><td>100 KB</td></tr><tr><td>Object</td><td>3</td><td>8 KB</td><td>50 KB</td></tr><tr><td>MyClass</td><td>1</td><td>16 KB</td><td>200 KB</td></tr></tbody></table><p><strong>解释</strong>：</p><ul><li>一个由 <code>Array</code> 构造函数创建的对象，距离根对象为 2，自己占用 24 KB 的内存，且如果这个对象被释放，能够回收总共 100 KB 的内存。</li><li>一个由 <code>Object</code> 构造函数创建的对象，距离根对象为 3，自己占用 8 KB 的内存，能够回收 50 KB 的内存。</li><li>一个由 <code>MyClass</code> 构造函数创建的对象，距离根对象为 1，自己占用 16 KB 的内存，能够回收 200 KB 的内存。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="总结"><strong>总结</strong><a class="hash-link" href="#总结" title="标题的直接链接">​</a></h3><ul><li><strong>构造函数</strong>：了解对象的来源和类型，便于定位代码。</li><li><strong>距离</strong>：评估对象被引用的路径长度，帮助识别潜在的内存泄漏。</li><li><strong>浅层大小</strong>：了解单个对象的内存占用，优化单个对象的内存使用。</li><li><strong>保留大小</strong>：识别哪些对象的释放可以带来最大的内存回收，优先优化这些对象。</li></ul><p>通过理解这些指标，开发者可以更有效地分析内存使用情况，识别和解决内存泄漏问题，从而提升应用的性能和稳定性。</p><p>在 Chrome 浏览器的开发者工具（DevTools）中，通过 <strong>Memory（内存）</strong> 标签页拍摄堆快照（Heap Snapshot）后，<strong>构造函数（Constructor）</strong> 列显示了内存中各种对象的类型。当分析内存泄漏时，关注特定类型的构造函数项可以帮助快速定位问题。以下是针对内存泄漏，主要需要观察的构造函数项及其相关特征：</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2分析内存泄露关注特定类型的构造函数项">2.分析内存泄露关注特定类型的构造函数项<a class="hash-link" href="#2分析内存泄露关注特定类型的构造函数项" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-detached-dom-节点">1. <strong>Detached DOM 节点</strong><a class="hash-link" href="#1-detached-dom-节点" title="标题的直接链接">​</a></h3><p><strong>描述</strong>：</p><ul><li><strong>Detached DOM 节点</strong> 是指已经从 DOM 树中移除，但由于某些引用（如事件监听器、闭包等）仍然存在，导致这些节点无法被垃圾回收。</li></ul><p><strong>构造函数示例</strong>：</p><ul><li><code>Detached HTMLDivElement</code></li><li><code>Detached HTMLButtonElement</code></li><li><code>Detached HTMLImageElement</code></li><li>其他 <code>Detached HTMLElement</code> 类型</li></ul><p><strong>观察要点</strong>：</p><ul><li><strong>数量异常</strong>：如果某一类 <code>Detached</code> 节点数量持续增加，可能表明存在内存泄漏。</li><li><strong>保留大小（Retained Size）</strong>：查看这些 <code>Detached</code> 节点的保留大小，了解它们占用了多少内存。</li></ul><p><strong>示例</strong>：
| 构造函数               | 距离 | 浅层大小 | 保留大小 |
|----------------------|-----|---------|---------|
| Detached HTMLDivElement | 3   | 24 KB   | 100 KB  |
| Detached HTMLButtonElement | 2   | 16 KB   | 50 KB   |</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-closure闭包">2. <strong>Closure（闭包）</strong><a class="hash-link" href="#2-closure闭包" title="标题的直接链接">​</a></h3><p><strong>描述</strong>：</p><ul><li><strong>闭包</strong> 持有对外部函数作用域的引用。如果闭包不正确地管理，可能会持有对不再需要的对象的引用，导致内存泄漏。</li></ul><p><strong>构造函数示例</strong>：</p><ul><li><code>Closure</code></li></ul><p><strong>观察要点</strong>：</p><ul><li><strong>保留路径</strong>：分析闭包持有的引用，查看是否持有大量不必要的对象。</li><li><strong>保留大小</strong>：较大的保留大小可能意味着闭包中持有大量数据。</li></ul><p><strong>示例</strong>：
| 构造函数 | 距离 | 浅层大小 | 保留大小 |
|---------|-----|---------|---------|
| Closure | 4   | 8 KB    | 80 KB   |</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-event-listener事件监听器">3. <strong>Event Listener（事件监听器）</strong><a class="hash-link" href="#3-event-listener事件监听器" title="标题的直接链接">​</a></h3><p><strong>描述</strong>：</p><ul><li><strong>事件监听器</strong> 持有对 DOM 节点或其他对象的引用。如果在移除 DOM 节点时未移除事件监听器，会导致这些节点无法被垃圾回收。</li></ul><p><strong>构造函数示例</strong>：</p><ul><li><code>EventListener</code></li><li><code>HTMLDivElement</code>（如果与事件监听器相关）</li></ul><p><strong>观察要点</strong>：</p><ul><li><strong>数量和保留大小</strong>：过多的事件监听器或高保留大小可能表明存在泄漏。</li><li><strong>引用路径</strong>：分析事件监听器的引用路径，找出持有它们的对象。</li></ul><p><strong>示例</strong>：
| 构造函数        | 距离 | 浅层大小 | 保留大小 |
|-----------------|-----|---------|---------|
| EventListener   | 3   | 12 KB   | 90 KB   |</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-全局对象global-objects">4. <strong>全局对象（Global Objects）</strong><a class="hash-link" href="#4-全局对象global-objects" title="标题的直接链接">​</a></h3><p><strong>描述</strong>：</p><ul><li><strong>全局对象</strong>（如 <code>window</code>）持有对大量对象的引用。如果不小心在全局作用域中存储了大量数据或对象，会导致内存泄漏。</li></ul><p><strong>构造函数示例</strong>：</p><ul><li><code>Window</code></li><li><code>Global</code></li></ul><p><strong>观察要点</strong>：</p><ul><li><strong>意外的大量对象</strong>：检查全局对象下是否存在大量意外的子对象。</li><li><strong>保留大小</strong>：高保留大小表示全局对象持有大量内存。</li></ul><p><strong>示例</strong>：
| 构造函数 | 距离 | 浅层大小 | 保留大小 |
|---------|-----|---------|---------|
| Window  | 0   | 200 KB  | 500 KB  |</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-第三方库对象">5. <strong>第三方库对象</strong><a class="hash-link" href="#5-第三方库对象" title="标题的直接链接">​</a></h3><p><strong>描述</strong>：</p><ul><li>使用第三方库（如 jQuery、React 等）时，如果不正确管理这些库创建的对象，可能导致内存泄漏。</li></ul><p><strong>构造函数示例</strong>：</p><ul><li><code>jQuery</code></li><li><code>ReactComponent</code></li><li><code>VueComponent</code></li></ul><p><strong>观察要点</strong>：</p><ul><li><strong>异常数量和保留大小</strong>：第三方库相关对象数量异常或保留大小过大，可能表明泄漏。</li><li><strong>引用路径</strong>：分析这些对象的引用路径，确认是否被正确管理。</li></ul><p><strong>示例</strong>：
| 构造函数     | 距离 | 浅层大小 | 保留大小 |
|--------------|-----|---------|---------|
| jQuery       | 2   | 30 KB   | 150 KB  |
| ReactComponent| 3   | 25 KB   | 120 KB  |</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-自定义类实例">6. <strong>自定义类实例</strong><a class="hash-link" href="#6-自定义类实例" title="标题的直接链接">​</a></h3><p><strong>描述</strong>：</p><ul><li>自定义类或构造函数创建的实例，如果未正确管理引用，可能导致内存泄漏。</li></ul><p><strong>构造函数示例</strong>：</p><ul><li><code>MyClass</code></li><li><code>CustomWidget</code></li></ul><p><strong>观察要点</strong>：</p><ul><li><strong>数量和保留大小</strong>：大量的自定义类实例或高保留大小需要关注。</li><li><strong>引用路径</strong>：确认这些实例是否有不必要的持久引用。</li></ul><p><strong>示例</strong>：
| 构造函数 | 距离 | 浅层大小 | 保留大小 |
|---------|-----|---------|---------|
| MyClass | 1   | 40 KB   | 200 KB  |
| CustomWidget | 2 | 35 KB | 180 KB  |</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-大对象和数据结构">7. <strong>大对象和数据结构</strong><a class="hash-link" href="#7-大对象和数据结构" title="标题的直接链接">​</a></h3><p><strong>描述</strong>：</p><ul><li>包含大量数据的大对象或复杂数据结构（如大数组、大对象）如果不正确管理，也可能导致内存泄漏。</li></ul><p><strong>构造函数示例</strong>：</p><ul><li><code>Array</code></li><li><code>Object</code></li></ul><p><strong>观察要点</strong>：</p><ul><li><strong>浅层大小和保留大小</strong>：异常大的数组或对象需要检查是否有不必要的数据存储。</li><li><strong>引用路径</strong>：分析这些大对象的引用路径，确认是否有持续的引用。</li></ul><p><strong>示例</strong>：
| 构造函数 | 距离 | 浅层大小 | 保留大小 |
|---------|-----|---------|---------|
| Array   | 3   | 100 KB  | 400 KB  |
| Object  | 2   | 80 KB   | 300 KB  |</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="综合观察策略"><strong>综合观察策略</strong><a class="hash-link" href="#综合观察策略" title="标题的直接链接">​</a></h3><ol><li><p><strong>关注 &quot;Detached&quot; 构造函数</strong>：</p><ul><li><strong>原因</strong>：<code>Detached</code> 表示已经从 DOM 中移除的节点仍被引用，是内存泄漏的常见来源。</li><li><strong>操作</strong>：查找所有 <code>Detached HTMLElement</code> 类型，分析其引用路径，找出持有引用的对象（如事件监听器、闭包等）。</li></ul></li><li><p><strong>分析高保留大小的构造函数</strong>：</p><ul><li><strong>原因</strong>：高保留大小表示该对象及其引用的所有对象占用了大量内存，优化这些对象可以显著减少内存占用。</li><li><strong>操作</strong>：优先查看保留大小较大的构造函数项，分析其引用链，找出不必要的引用。</li></ul></li><li><p><strong>检查频繁增长的构造函数项</strong>：</p><ul><li><strong>原因</strong>：如果某些构造函数的实例数量在多次快照中持续增加，可能存在泄漏。</li><li><strong>操作</strong>：对比多个堆快照，观察哪些构造函数的实例数量在不断增加。</li></ul></li><li><p><strong>关注全局对象引用</strong>：</p><ul><li><strong>原因</strong>：全局对象持有的引用生命周期长，容易不小心持有不必要的对象。</li><li><strong>操作</strong>：检查全局对象（如 <code>window</code>）下的子对象，确保没有不必要的引用。</li></ul></li><li><p><strong>使用过滤和排序功能</strong>：</p><ul><li><strong>方法</strong>：在堆快照表格中，使用过滤功能按构造函数名称筛选，或按保留大小排序，快速定位潜在的泄漏源。</li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="示例操作步骤"><strong>示例操作步骤</strong><a class="hash-link" href="#示例操作步骤" title="标题的直接链接">​</a></h3><ol><li><p><strong>拍摄堆快照</strong>：</p><ul><li>打开 Chrome DevTools，选择 <strong>Memory</strong> 标签页。</li><li>选择 <strong>Heap Snapshot</strong>，点击 <strong>Take snapshot</strong>。</li></ul></li><li><p><strong>过滤 &quot;Detached&quot; 对象</strong>：</p><ul><li>在堆快照表格中，输入 <code>Detached</code> 进行过滤。</li><li>分析所有 <code>Detached</code> 对象的引用路径，找出持有引用的源头。</li></ul></li><li><p><strong>排序保留大小</strong>：</p><ul><li>点击 <strong>保留大小</strong> 列，对对象按保留大小进行排序。</li><li>查看保留大小较大的对象，分析其引用链，确定是否为泄漏源。</li></ul></li><li><p><strong>对比多个堆快照</strong>：</p><ul><li>拍摄多个快照（例如，在不同时间点或不同操作后）。</li><li>比较快照中的构造函数项，观察哪些类型的对象数量持续增加。</li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="预防和修复内存泄漏的最佳实践"><strong>预防和修复内存泄漏的最佳实践</strong><a class="hash-link" href="#预防和修复内存泄漏的最佳实践" title="标题的直接链接">​</a></h3><ul><li><p><strong>正确移除事件监听器</strong>：</p><ul><li>在移除 DOM 节点或组件时，确保移除所有相关的事件监听器。</li></ul><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">removeElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">element</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;click&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleClick</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">parentNode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handleClick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Clicked!&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> btn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;button&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">btn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;click&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleClick</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">btn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 当不需要按钮时，先移除事件监听器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">removeElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">btn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>避免在闭包中持有不必要的引用</strong>：</p><ul><li>确保闭包中不持有对已移除对象的引用，或在不需要时清理引用。</li></ul><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> element </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;div&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">innerHTML</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 当不需要 handler 时，清理引用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cleanup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    element </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> handler</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cleanup </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> handler</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cleanup </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 使用 handler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cleanup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 允许 element 被垃圾回收</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>使用现代框架的生命周期管理</strong>：</p><ul><li>利用 React、Vue 等框架提供的生命周期钩子，自动管理资源清理。</li></ul><p><strong>React 示例</strong>：</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> useEffect </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;react&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">MyComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handleClick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Clicked!&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> btn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;my-button&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    btn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;click&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleClick</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 清理函数，组件卸载时调用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      btn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;click&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleClick</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">my-button</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">Click Me</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>使用 WeakRef 或 WeakMap</strong>：</p><ul><li>在需要持有对象引用但不希望阻止垃圾回收时，使用 <code>WeakRef</code> 或 <code>WeakMap</code>。</li></ul><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> weakMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">WeakMap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">associate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">element</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  weakMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> div </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;div&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">associate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">info</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Some data&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// div 现在成为 Detached DOM，如果没有其他引用，div 和其关联的数据可以被垃圾回收</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="总结-1"><strong>总结</strong><a class="hash-link" href="#总结-1" title="标题的直接链接">​</a></h3><p>在分析 Chrome DevTools 中的堆快照以查找内存泄漏时，<strong>构造函数（Constructor）</strong> 列中的以下项需要特别关注：</p><ol><li><strong>Detached DOM 节点</strong>：如 <code>Detached HTMLDivElement</code>，表明这些节点被移除但仍被引用。</li><li><strong>Closure（闭包）</strong>：持有不必要引用的闭包可能导致内存泄漏。</li><li><strong>Event Listener（事件监听器）</strong>：未移除的事件监听器会持续引用 DOM 节点或其他对象。</li><li><strong>全局对象</strong>：全局作用域下的不必要引用可能导致长期内存占用。</li><li><strong>第三方库对象</strong>：不正确使用第三方库可能引入内存泄漏。</li><li><strong>自定义类实例</strong>：自定义类的实例如果未正确管理引用，也可能导致泄漏。</li><li><strong>大对象和数据结构</strong>：异常大的对象或数据结构可能隐藏泄漏问题。</li></ol><p>通过系统地分析这些构造函数项，结合 <strong>距离（Distance）</strong>、<strong>浅层大小（Shallow Size）</strong> 和 <strong>保留大小（Retained Size）</strong> 等指标，可以有效地识别和解决内存泄漏问题，提升应用的性能和稳定性。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-堆快照表格含义" class="table-of-contents__link toc-highlight">1. 堆快照表格含义</a><ul><li><a href="#1-构造函数constructor" class="table-of-contents__link toc-highlight">1. 构造函数（Constructor）</a></li><li><a href="#2-距离distance" class="table-of-contents__link toc-highlight">2. 距离（Distance）</a></li><li><a href="#3-浅层大小shallow-size" class="table-of-contents__link toc-highlight">3. 浅层大小（Shallow Size）</a></li><li><a href="#4-保留大小retained-size" class="table-of-contents__link toc-highlight">4. 保留大小（Retained Size）</a></li><li><a href="#综合示例" class="table-of-contents__link toc-highlight"><strong>综合示例</strong></a></li><li><a href="#总结" class="table-of-contents__link toc-highlight"><strong>总结</strong></a></li></ul></li><li><a href="#2分析内存泄露关注特定类型的构造函数项" class="table-of-contents__link toc-highlight">2.分析内存泄露关注特定类型的构造函数项</a><ul><li><a href="#1-detached-dom-节点" class="table-of-contents__link toc-highlight">1. <strong>Detached DOM 节点</strong></a></li><li><a href="#2-closure闭包" class="table-of-contents__link toc-highlight">2. <strong>Closure（闭包）</strong></a></li><li><a href="#3-event-listener事件监听器" class="table-of-contents__link toc-highlight">3. <strong>Event Listener（事件监听器）</strong></a></li><li><a href="#4-全局对象global-objects" class="table-of-contents__link toc-highlight">4. <strong>全局对象（Global Objects）</strong></a></li><li><a href="#5-第三方库对象" class="table-of-contents__link toc-highlight">5. <strong>第三方库对象</strong></a></li><li><a href="#6-自定义类实例" class="table-of-contents__link toc-highlight">6. <strong>自定义类实例</strong></a></li><li><a href="#7-大对象和数据结构" class="table-of-contents__link toc-highlight">7. <strong>大对象和数据结构</strong></a></li><li><a href="#综合观察策略" class="table-of-contents__link toc-highlight"><strong>综合观察策略</strong></a></li><li><a href="#示例操作步骤" class="table-of-contents__link toc-highlight"><strong>示例操作步骤</strong></a></li><li><a href="#预防和修复内存泄漏的最佳实践" class="table-of-contents__link toc-highlight"><strong>预防和修复内存泄漏的最佳实践</strong></a></li><li><a href="#总结-1" class="table-of-contents__link toc-highlight"><strong>总结</strong></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/iiLsss/iiLsss.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 地球, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.61b4b5da.js"></script>
<script src="/assets/js/main.66584053.js"></script>
</body>
</html>