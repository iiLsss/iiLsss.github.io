<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-devtool/memory-teach">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">使用 Chrome DevTools 的 Memory 工具排查和解决内存泄漏问题 —— 教程 | iiLsss</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://iilsss.github.io//docs/devtool/memory-teach"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="使用 Chrome DevTools 的 Memory 工具排查和解决内存泄漏问题 —— 教程 | iiLsss"><meta data-rh="true" name="description" content="在前端开发中，内存泄漏（Memory Leak）会导致应用性能下降、响应变慢，甚至导致浏览器崩溃。Chrome 浏览器的开发者工具（DevTools）提供了强大的 Memory 标签页，用于分析和调试内存相关的问题。本教程将详细介绍如何使用 Memory 工具拍摄堆快照、分析内存使用情况，并通过实际步骤解决内存泄漏问题。"><meta data-rh="true" property="og:description" content="在前端开发中，内存泄漏（Memory Leak）会导致应用性能下降、响应变慢，甚至导致浏览器崩溃。Chrome 浏览器的开发者工具（DevTools）提供了强大的 Memory 标签页，用于分析和调试内存相关的问题。本教程将详细介绍如何使用 Memory 工具拍摄堆快照、分析内存使用情况，并通过实际步骤解决内存泄漏问题。"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://iilsss.github.io//docs/devtool/memory-teach"><link data-rh="true" rel="alternate" href="https://iilsss.github.io//docs/devtool/memory-teach" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://iilsss.github.io//docs/devtool/memory-teach" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="iiLsss RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="iiLsss Atom Feed"><link rel="stylesheet" href="/assets/css/styles.28aaf335.css">
<link rel="preload" href="/assets/js/runtime~main.0980ab72.js" as="script">
<link rel="preload" href="/assets/js/main.63f0261d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">地球</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro/">Note</a><a class="navbar__item navbar__link header-react-link" href="/docs/react/">React</a><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">More</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/interview/">📙 知识体系</a></li><li><a class="dropdown__link" href="/tool">🛠️ 工具</a></li></ul></div><a href="https://github.com/iiLsss/iiLsss.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>使用 Chrome DevTools 的 Memory 工具排查和解决内存泄漏问题 —— 教程</h1><p>在前端开发中，内存泄漏（Memory Leak）会导致应用性能下降、响应变慢，甚至导致浏览器崩溃。Chrome 浏览器的开发者工具（DevTools）提供了强大的 <strong>Memory</strong> 标签页，用于分析和调试内存相关的问题。本教程将详细介绍如何使用 <strong>Memory</strong> 工具拍摄堆快照、分析内存使用情况，并通过实际步骤解决内存泄漏问题。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="目录">目录<a class="hash-link" href="#目录" title="标题的直接链接">​</a></h2><ul><li><a href="#%E4%BD%BF%E7%94%A8-chrome-devtools-%E7%9A%84-memory-%E5%B7%A5%E5%85%B7%E6%8E%92%E6%9F%A5%E5%92%8C%E8%A7%A3%E5%86%B3%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E9%97%AE%E9%A2%98--%E6%95%99%E7%A8%8B">使用 Chrome DevTools 的 Memory 工具排查和解决内存泄漏问题 —— 教程</a><ul><li><a href="#%E7%9B%AE%E5%BD%95">目录</a></li><li><a href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F">1. 什么是内存泄漏</a></li><li><a href="#2-chrome-devtools-%E4%B8%AD%E7%9A%84-memory-%E5%B7%A5%E5%85%B7%E6%A6%82%E8%BF%B0">2. Chrome DevTools 中的 Memory 工具概述</a><ul><li><a href="#memory-%E6%A0%87%E7%AD%BE%E9%A1%B5%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD">Memory 标签页的主要功能：</a></li></ul></li><li><a href="#3-%E6%8B%8D%E6%91%84%E5%A0%86%E5%BF%AB%E7%85%A7heap-snapshot">3. 拍摄堆快照（Heap Snapshot）</a><ul><li><a href="#%E6%AD%A5%E9%AA%A4">步骤：</a></li></ul></li><li><a href="#4-%E5%88%86%E6%9E%90%E5%A0%86%E5%BF%AB%E7%85%A7">4. 分析堆快照</a><ul><li><a href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0constructor">构造函数（Constructor）</a></li><li><a href="#%E8%B7%9D%E7%A6%BBdistance">距离（Distance）</a></li><li><a href="#%E6%B5%85%E5%B1%82%E5%A4%A7%E5%B0%8Fshallow-size">浅层大小（Shallow Size）</a></li><li><a href="#%E4%BF%9D%E7%95%99%E5%A4%A7%E5%B0%8Fretained-size">保留大小（Retained Size）</a></li></ul></li><li><a href="#5-%E8%AF%86%E5%88%AB%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F">5. 识别内存泄漏</a><ul><li><a href="#51-%E5%85%B3%E6%B3%A8-detached-dom-%E8%8A%82%E7%82%B9">5.1 关注 Detached DOM 节点</a></li><li><a href="#52-%E5%88%86%E6%9E%90%E9%AB%98%E4%BF%9D%E7%95%99%E5%A4%A7%E5%B0%8F%E7%9A%84%E5%AF%B9%E8%B1%A1">5.2 分析高保留大小的对象</a></li><li><a href="#53-%E5%AF%B9%E6%AF%94%E5%A4%9A%E4%B8%AA%E5%A0%86%E5%BF%AB%E7%85%A7">5.3 对比多个堆快照</a></li></ul></li><li><a href="#6-%E8%A7%A3%E5%86%B3%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F">6. 解决内存泄漏</a><ul><li><a href="#61-%E7%A7%BB%E9%99%A4%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8">6.1 移除不必要的事件监听器</a></li><li><a href="#62-%E6%B8%85%E7%90%86%E9%97%AD%E5%8C%85%E4%B8%AD%E7%9A%84%E5%BC%95%E7%94%A8">6.2 清理闭包中的引用</a></li><li><a href="#63-%E6%AD%A3%E7%A1%AE%E7%AE%A1%E7%90%86%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F">6.3 正确管理全局变量</a></li><li><a href="#64-%E4%BD%BF%E7%94%A8%E7%8E%B0%E4%BB%A3%E6%A1%86%E6%9E%B6%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86">6.4 使用现代框架的生命周期管理</a></li></ul></li><li><a href="#7-%E9%AA%8C%E8%AF%81%E4%BF%AE%E5%A4%8D">7. 验证修复</a><ul><li><a href="#%E6%AD%A5%E9%AA%A4-1">步骤：</a></li></ul></li><li><a href="#8-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">8. 最佳实践</a><ul><li><a href="#81-%E5%AE%9A%E6%9C%9F%E7%9B%91%E6%8E%A7%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8">8.1 定期监控内存使用</a></li><li><a href="#82-%E9%81%B5%E5%BE%AA%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83">8.2 遵循编码规范</a></li><li><a href="#83-%E4%BD%BF%E7%94%A8%E7%8E%B0%E4%BB%A3%E6%A1%86%E6%9E%B6%E7%9A%84%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD">8.3 使用现代框架的资源管理功能</a></li><li><a href="#84-%E4%BD%BF%E7%94%A8%E5%BC%B1%E5%BC%95%E7%94%A8">8.4 使用弱引用</a></li><li><a href="#85-%E4%BC%98%E5%8C%96%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">8.5 优化数据结构</a></li></ul></li><li><a href="#9-%E6%80%BB%E7%BB%93">9. 总结</a><ul><li><a href="#%E5%9C%BA%E6%99%AF%E6%8F%8F%E8%BF%B0">场景描述</a></li><li><a href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90">问题分析</a></li></ul></li></ul></li></ul><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-什么是内存泄漏">1. 什么是内存泄漏<a class="hash-link" href="#1-什么是内存泄漏" title="标题的直接链接">​</a></h2><p><strong>内存泄漏</strong> 指的是程序在运行过程中未能正确释放不再使用的内存，导致可用内存不断减少，最终可能导致应用性能下降或崩溃。在前端应用中，常见的内存泄漏原因包括：</p><ul><li><strong>Detached DOM 节点</strong>：已从 DOM 树中移除的节点仍被引用，无法被垃圾回收。</li><li><strong>未移除的事件监听器</strong>：事件监听器持有对 DOM 节点或其他对象的引用。</li><li><strong>闭包持有不必要的引用</strong>：闭包中引用了不再需要的对象。</li><li><strong>全局变量</strong>：不小心创建的全局变量持有大量数据。</li><li><strong>第三方库的不当使用</strong>。</li></ul><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-chrome-devtools-中的-memory-工具概述">2. Chrome DevTools 中的 Memory 工具概述<a class="hash-link" href="#2-chrome-devtools-中的-memory-工具概述" title="标题的直接链接">​</a></h2><p><strong>Chrome DevTools</strong> 提供了 <strong>Memory</strong> 标签页，用于分析页面的内存使用情况。通过 Memory 工具，可以拍摄堆快照（Heap Snapshot）、记录分配时间线（Allocation Timeline）和进行性能分析（Performance Profiling）。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="memory-标签页的主要功能">Memory 标签页的主要功能：<a class="hash-link" href="#memory-标签页的主要功能" title="标题的直接链接">​</a></h3><ul><li><strong>Heap Snapshot</strong>：捕捉页面在特定时间点的内存分配情况。</li><li><strong>Allocation Timeline</strong>：记录内存分配的实时变化，帮助识别内存增长趋势。</li><li><strong>Allocation Sampling</strong>：采样内存分配，分析内存使用模式。</li></ul><p>在本教程中，我们将重点关注 <strong>Heap Snapshot</strong>，因为它能够详细展示内存中对象的类型、数量及其引用关系，有助于识别内存泄漏。</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-拍摄堆快照heap-snapshot">3. 拍摄堆快照（Heap Snapshot）<a class="hash-link" href="#3-拍摄堆快照heap-snapshot" title="标题的直接链接">​</a></h2><p>堆快照是内存分析的基础，通过它可以查看页面当前内存中的所有对象及其引用关系。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="步骤">步骤：<a class="hash-link" href="#步骤" title="标题的直接链接">​</a></h3><ol><li><p><strong>打开 Chrome DevTools</strong>：</p><ul><li>在 Chrome 浏览器中，按 <code>F12</code> 或 <code>Ctrl + Shift + I</code>（Windows/Linux）/<code>Cmd + Option + I</code>（Mac）打开 DevTools。</li></ul></li><li><p><strong>导航到 Memory 标签页</strong>：</p><ul><li>在 DevTools 界面顶部，点击 <strong>Memory</strong> 标签。如果没有看到，点击 <code>&gt;&gt;</code> 展开更多标签。</li></ul><p><img loading="lazy" src="https://i.imgur.com/Fd3Iv9U.png" alt="Memory Tab" class="img_ev3q"></p></li><li><p><strong>选择 Heap Snapshot</strong>：</p><ul><li>在 Memory 标签页中，选择 <strong>Heap Snapshot</strong> 模式。</li></ul></li><li><p><strong>拍摄堆快照</strong>：</p><ul><li>点击 <strong>Take snapshot</strong> 按钮，开始拍摄堆快照。</li></ul><p><img loading="lazy" src="https://i.imgur.com/G1h3K3G.png" alt="Take Snapshot" class="img_ev3q"></p></li><li><p><strong>等待快照完成</strong>：</p><ul><li>拍摄过程可能需要几秒钟，取决于页面的复杂度和内存使用情况。完成后，快照将显示在左侧面板中。</li></ul><p><img loading="lazy" src="https://i.imgur.com/9bF5eZi.png" alt="Heap Snapshot" class="img_ev3q"></p></li></ol><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-分析堆快照">4. 分析堆快照<a class="hash-link" href="#4-分析堆快照" title="标题的直接链接">​</a></h2><p>堆快照包含多个列，主要包括 <strong>构造函数（Constructor）</strong>、<strong>距离（Distance）</strong>、<strong>浅层大小（Shallow Size）</strong> 和 <strong>保留大小（Retained Size）</strong>。了解这些指标有助于识别内存泄漏。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="构造函数constructor">构造函数（Constructor）<a class="hash-link" href="#构造函数constructor" title="标题的直接链接">​</a></h3><p><strong>定义</strong>：</p><ul><li>显示对象的构造器函数或类的名称。</li></ul><p><strong>作用</strong>：</p><ul><li>识别对象的类型，帮助定位代码中的相关部分。</li></ul><p><strong>示例</strong>：</p><table><thead><tr><th>构造函数</th><th>对象数量</th></tr></thead><tbody><tr><td>Array</td><td>5000</td></tr><tr><td>Object</td><td>3000</td></tr><tr><td>HTMLDivElement</td><td>1500</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="距离distance">距离（Distance）<a class="hash-link" href="#距离distance" title="标题的直接链接">​</a></h3><p><strong>定义</strong>：</p><ul><li>从 <strong>根对象（Roots）</strong> 到当前对象的引用链长度。</li></ul><p><strong>作用</strong>：</p><ul><li>距离越小，表示对象越接近根对象，更容易被访问和保留。</li><li>距离较大的对象可能通过较长的引用链被保留，可能与内存泄漏相关。</li></ul><p><strong>解释</strong>：</p><ul><li>距离为 0：对象是根对象之一（如 <code>window</code>）。</li><li>距离为 1：对象直接由根对象引用。</li><li>距离为 n：需要经过 n 步引用才能到达该对象。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="浅层大小shallow-size">浅层大小（Shallow Size）<a class="hash-link" href="#浅层大小shallow-size" title="标题的直接链接">​</a></h3><p><strong>定义</strong>：</p><ul><li>对象本身在内存中占用的空间，不包括它引用的其他对象所占用的内存。</li></ul><p><strong>作用</strong>：</p><ul><li>了解单个对象的内存消耗，识别内存占用较大的对象类型。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="保留大小retained-size">保留大小（Retained Size）<a class="hash-link" href="#保留大小retained-size" title="标题的直接链接">​</a></h3><p><strong>定义</strong>：</p><ul><li>如果该对象被垃圾回收，能够被释放的所有内存总和，包括该对象本身和它引用的所有对象。</li></ul><p><strong>作用</strong>：</p><ul><li>识别哪些对象的释放将带来最大的内存回收量，有助于优先优化这些对象。</li></ul><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-识别内存泄漏">5. 识别内存泄漏<a class="hash-link" href="#5-识别内存泄漏" title="标题的直接链接">​</a></h2><p>通过分析堆快照，可以识别出潜在的内存泄漏。以下是常见的识别步骤和重点关注的构造函数项。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-关注-detached-dom-节点">5.1 关注 Detached DOM 节点<a class="hash-link" href="#51-关注-detached-dom-节点" title="标题的直接链接">​</a></h3><p><strong>描述</strong>：</p><ul><li><strong>Detached DOM 节点</strong> 是指已从 DOM 树中移除，但仍被引用的节点，无法被垃圾回收。</li></ul><p><strong>如何识别</strong>：</p><ul><li>在 <strong>构造函数（Constructor）</strong> 列中查找 <strong>&quot;Detached&quot;</strong> 开头的项，如 <code>Detached HTMLDivElement</code>。</li><li>查看这些对象的 <strong>保留大小（Retained Size）</strong>，了解它们占用了多少内存。</li></ul><p><strong>示例</strong>：</p><table><thead><tr><th>构造函数</th><th>距离</th><th>浅层大小</th><th>保留大小</th></tr></thead><tbody><tr><td>Detached HTMLDivElement</td><td>3</td><td>24 KB</td><td>100 KB</td></tr><tr><td>Detached HTMLButtonElement</td><td>2</td><td>16 KB</td><td>50 KB</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-分析高保留大小的对象">5.2 分析高保留大小的对象<a class="hash-link" href="#52-分析高保留大小的对象" title="标题的直接链接">​</a></h3><p><strong>描述</strong>：</p><ul><li>高保留大小表示该对象及其引用的所有对象占用了大量内存，优化这些对象可以显著减少内存占用。</li></ul><p><strong>如何识别</strong>：</p><ul><li>在堆快照中，按 <strong>保留大小（Retained Size）</strong> 降序排序。</li><li>重点关注保留大小较大的对象，分析其引用链。</li></ul><p><strong>示例</strong>：</p><table><thead><tr><th>构造函数</th><th>距离</th><th>浅层大小</th><th>保留大小</th></tr></thead><tbody><tr><td>ReactComponent</td><td>3</td><td>25 KB</td><td>120 KB</td></tr><tr><td>jQuery</td><td>2</td><td>30 KB</td><td>150 KB</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-对比多个堆快照">5.3 对比多个堆快照<a class="hash-link" href="#53-对比多个堆快照" title="标题的直接链接">​</a></h3><p><strong>描述</strong>：</p><ul><li>对比不同时间点或不同操作后的堆快照，观察哪些对象的数量持续增加。</li></ul><p><strong>如何识别</strong>：</p><ul><li>拍摄多个堆快照，尤其是在执行特定操作前后。</li><li>比较快照中的对象数量，查找持续增长的对象类型。</li></ul><p><strong>示例</strong>：</p><ol><li><strong>初始快照</strong>：页面加载时拍摄堆快照。</li><li><strong>操作快照</strong>：执行某些操作（如打开/关闭模态框）后拍摄堆快照。</li><li><strong>比较快照</strong>：查看哪些构造函数的对象数量在操作后显著增加。</li></ol><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-解决内存泄漏">6. 解决内存泄漏<a class="hash-link" href="#6-解决内存泄漏" title="标题的直接链接">​</a></h2><p>一旦识别出内存泄漏的来源，接下来需要通过代码优化和资源管理来解决问题。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="61-移除不必要的事件监听器">6.1 移除不必要的事件监听器<a class="hash-link" href="#61-移除不必要的事件监听器" title="标题的直接链接">​</a></h3><p><strong>问题</strong>：</p><ul><li>事件监听器持有对 DOM 节点的引用，未移除监听器会导致节点无法被回收。</li></ul><p><strong>解决方法</strong>：</p><ul><li>在移除 DOM 节点前，确保移除所有相关的事件监听器。</li></ul><p><strong>示例</strong>：</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 添加事件监听器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">addButton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> btn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;button&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  btn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">textContent</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Click Me&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handleClick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Button clicked&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  btn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;click&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleClick</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">btn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 移除按钮时，先移除事件监听器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">removeButton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    btn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;click&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleClick</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">btn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> removeButton</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> removeBtn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">addButton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 调用 removeBtn() 时，按钮及其事件监听器将被移除</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="62-清理闭包中的引用">6.2 清理闭包中的引用<a class="hash-link" href="#62-清理闭包中的引用" title="标题的直接链接">​</a></h3><p><strong>问题</strong>：</p><ul><li>闭包持有对不再需要的对象的引用，导致这些对象无法被垃圾回收。</li></ul><p><strong>解决方法</strong>：</p><ul><li>确保闭包中不持有不必要的引用，或在不需要时手动清理引用。</li></ul><p><strong>示例</strong>：</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> element </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;div&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">innerHTML</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 使用 handler</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 当不需要 handler 时，清理引用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cleanup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    element </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> handler</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cleanup </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> handler</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cleanup </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">createHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 调用 cleanup() 后，element 可以被垃圾回收</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cleanup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="63-正确管理全局变量">6.3 正确管理全局变量<a class="hash-link" href="#63-正确管理全局变量" title="标题的直接链接">​</a></h3><p><strong>问题</strong>：</p><ul><li>不小心创建的全局变量持有大量数据，导致内存泄漏。</li></ul><p><strong>解决方法</strong>：</p><ul><li>避免使用全局变量，或确保在不需要时将其设置为 <code>null</code>。</li></ul><p><strong>示例</strong>：</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 不推荐的做法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">myData</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 大量数据 */</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 推荐的做法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> myData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 大量数据 */</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 使用完成后</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">myData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="64-使用现代框架的生命周期管理">6.4 使用现代框架的生命周期管理<a class="hash-link" href="#64-使用现代框架的生命周期管理" title="标题的直接链接">​</a></h3><p><strong>问题</strong>：</p><ul><li>在使用框架（如 React、Vue）时，未正确管理组件的生命周期，导致资源未被释放。</li></ul><p><strong>解决方法</strong>：</p><ul><li>利用框架提供的生命周期钩子，在组件卸载时清理资源。</li></ul><p><strong>React 示例</strong>：</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token imports punctuation" style="color:#393A34">,</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> useEffect </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;react&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">MyComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">useEffect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handleClick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Clicked!&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> btn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;my-button&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    btn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;click&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleClick</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 清理函数，组件卸载时调用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      btn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;click&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleClick</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">my-button</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain-text">Click Me</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Vue 示例</strong>：</p><div class="language-vue codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-vue codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;button ref=&quot;myButton&quot;&gt;Click Me&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/template&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;script&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export default {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mounted() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.handleClick = () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      console.log(&#x27;Clicked!&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.$refs.myButton.addEventListener(&#x27;click&#x27;, this.handleClick);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  beforeDestroy() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.$refs.myButton.removeEventListener(&#x27;click&#x27;, this.handleClick);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/script&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-验证修复">7. 验证修复<a class="hash-link" href="#7-验证修复" title="标题的直接链接">​</a></h2><p>在修改代码后，需要验证内存泄漏问题是否已解决。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="步骤-1">步骤：<a class="hash-link" href="#步骤-1" title="标题的直接链接">​</a></h3><ol><li><p><strong>重新加载页面</strong>：</p><ul><li>确保所有修改生效。</li></ul></li><li><p><strong>重复内存泄漏触发操作</strong>：</p><ul><li>执行导致内存泄漏的操作（如打开/关闭组件、多次添加/移除元素等）。</li></ul></li><li><p><strong>拍摄新的堆快照</strong>：</p><ul><li>在 Memory 标签页，点击 <strong>Take snapshot</strong>。</li></ul></li><li><p><strong>分析堆快照</strong>：</p><ul><li>检查是否仍存在 <strong>Detached DOM</strong> 节点或其他泄漏对象。</li><li>对比修改前后的保留大小和对象数量，确认是否有减少。</li></ul></li><li><p><strong>使用 Allocation Timeline 监控</strong>：</p><ul><li>在 Memory 标签页，选择 <strong>Allocation Timeline</strong>，记录内存分配情况，观察是否有持续增长。</li></ul></li></ol><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-最佳实践">8. 最佳实践<a class="hash-link" href="#8-最佳实践" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="81-定期监控内存使用">8.1 定期监控内存使用<a class="hash-link" href="#81-定期监控内存使用" title="标题的直接链接">​</a></h3><ul><li><strong>持续集成</strong>：在开发过程中，定期使用内存分析工具检测内存泄漏。</li><li><strong>自动化测试</strong>：编写内存相关的测试用例，监控内存使用情况。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="82-遵循编码规范">8.2 遵循编码规范<a class="hash-link" href="#82-遵循编码规范" title="标题的直接链接">​</a></h3><ul><li><strong>避免不必要的全局变量</strong>。</li><li><strong>正确管理事件监听器</strong>，确保在不需要时移除。</li><li><strong>谨慎使用闭包</strong>，避免持有不必要的引用。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="83-使用现代框架的资源管理功能">8.3 使用现代框架的资源管理功能<a class="hash-link" href="#83-使用现代框架的资源管理功能" title="标题的直接链接">​</a></h3><ul><li><strong>React</strong>：利用 <code>useEffect</code> 清理副作用。</li><li><strong>Vue</strong>：使用生命周期钩子管理资源。</li><li><strong>Angular</strong>：利用 <code>OnDestroy</code> 生命周期接口清理资源。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="84-使用弱引用">8.4 使用弱引用<a class="hash-link" href="#84-使用弱引用" title="标题的直接链接">​</a></h3><ul><li><strong>WeakMap / WeakSet</strong>：在需要持有对象引用但不希望阻止垃圾回收时使用。</li></ul><p><strong>示例</strong>：</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> weakMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">WeakMap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">associate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">element</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  weakMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> div </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;div&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">associate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">info</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Some data&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">div</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// div 和其关联的数据可以被垃圾回收</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="85-优化数据结构">8.5 优化数据结构<a class="hash-link" href="#85-优化数据结构" title="标题的直接链接">​</a></h3><ul><li>使用合适的数据结构，避免不必要的数据存储。</li><li>定期清理不再需要的数据。</li></ul><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="9-总结">9. 总结<a class="hash-link" href="#9-总结" title="标题的直接链接">​</a></h2><p>通过使用 Chrome DevTools 的 <strong>Memory</strong> 工具，可以有效地分析和解决前端应用中的内存泄漏问题。以下是关键步骤和要点：</p><ol><li><strong>拍摄堆快照</strong>：捕捉页面在特定时间点的内存分配情况。</li><li><strong>分析堆快照</strong>：<ul><li>关注 <strong>构造函数</strong>、<strong>距离</strong>、<strong>浅层大小</strong> 和 <strong>保留大小</strong>。</li><li>特别关注 <strong>Detached DOM</strong> 节点和高保留大小的对象。</li></ul></li><li><strong>识别内存泄漏</strong>：通过对比多个堆快照，查找持续增长的对象类型。</li><li><strong>解决内存泄漏</strong>：<ul><li>移除不必要的事件监听器。</li><li>清理闭包中的引用。</li><li>正确管理全局变量。</li><li>使用现代框架的生命周期管理功能。</li></ul></li><li><strong>验证修复</strong>：重新拍摄堆快照，确认内存泄漏已解决。</li><li><strong>遵循最佳实践</strong>：定期监控内存使用，遵循编码规范，优化数据结构。</li></ol><p>通过系统化的方法和工具支持，可以有效地识别和解决内存泄漏问题，提升前端应用的性能和稳定性。</p><hr><p><strong>附录：实战示例</strong></p><p>以下是一个实际案例，演示如何使用 <strong>Memory</strong> 工具识别和修复内存泄漏。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="场景描述">场景描述<a class="hash-link" href="#场景描述" title="标题的直接链接">​</a></h3><p>在一个单页应用（SPA）中，用户多次打开和关闭模态框，导致页面内存不断增长，最终导致浏览器崩溃。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题分析">问题分析<a class="hash-link" href="#问题分析" title="标题的直接链接">​</a></h3><ol><li><p><strong>拍摄初始堆快照</strong>：</p><ul><li>打开 DevTools，选择 <strong>Memory</strong> 标签页，拍摄堆快照。</li><li>记录对象类型和内存使用情况。</li></ul></li><li><p><strong>执行内存泄漏操作</strong>：</p><ul><li>多次打开和关闭模态框。</li></ul></li><li><p><strong>拍摄操作后的堆快照</strong>：</p><ul><li>重新拍摄堆快照，比较对象数量和保留大小。</li></ul></li><li><p><strong>发现问题</strong>：</p><ul><li>在 <strong>构造函数</strong> 列中发现大量 <strong>Detached HTMLDivElement</strong>。</li><li>保留大小较大，指示模态框元素未被正确释放。</li></ul></li><li><p><strong>定位代码</strong>：</p><ul><li>分析引用路径，发现事件监听器未被移除。</li></ul></li><li><p><strong>修复代码</strong>：</p><ul><li>在模态框组件的卸载生命周期钩子中移除事件监听器。</li></ul><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 修复前</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Modal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> btn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;modal-button&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  btn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;click&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleClick</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 修复后</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Modal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> btn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;modal-button&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  btn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;click&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleClick</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 清理函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cleanup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    btn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;click&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleClick</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 在组件卸载时调用 cleanup</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;beforeunload&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cleanup</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 或使用框架的生命周期钩子</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>验证修复</strong>：</p><ul><li>重新执行打开/关闭模态框操作，拍摄新的堆快照。</li><li>确认 <strong>Detached HTMLDivElement</strong> 的数量不再增加，内存使用稳定。</li></ul></li></ol><p>通过这一系列步骤，成功识别并修复了内存泄漏问题，提升了应用的性能和用户体验。</p><hr><p>希望本教程能帮助你更好地理解和使用 Chrome DevTools 的 <strong>Memory</strong> 工具，提升内存管理能力，构建高性能的前端应用。如有任何疑问，欢迎在评论区交流讨论！</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#目录" class="table-of-contents__link toc-highlight">目录</a></li><li><a href="#1-什么是内存泄漏" class="table-of-contents__link toc-highlight">1. 什么是内存泄漏</a></li><li><a href="#2-chrome-devtools-中的-memory-工具概述" class="table-of-contents__link toc-highlight">2. Chrome DevTools 中的 Memory 工具概述</a><ul><li><a href="#memory-标签页的主要功能" class="table-of-contents__link toc-highlight">Memory 标签页的主要功能：</a></li></ul></li><li><a href="#3-拍摄堆快照heap-snapshot" class="table-of-contents__link toc-highlight">3. 拍摄堆快照（Heap Snapshot）</a><ul><li><a href="#步骤" class="table-of-contents__link toc-highlight">步骤：</a></li></ul></li><li><a href="#4-分析堆快照" class="table-of-contents__link toc-highlight">4. 分析堆快照</a><ul><li><a href="#构造函数constructor" class="table-of-contents__link toc-highlight">构造函数（Constructor）</a></li><li><a href="#距离distance" class="table-of-contents__link toc-highlight">距离（Distance）</a></li><li><a href="#浅层大小shallow-size" class="table-of-contents__link toc-highlight">浅层大小（Shallow Size）</a></li><li><a href="#保留大小retained-size" class="table-of-contents__link toc-highlight">保留大小（Retained Size）</a></li></ul></li><li><a href="#5-识别内存泄漏" class="table-of-contents__link toc-highlight">5. 识别内存泄漏</a><ul><li><a href="#51-关注-detached-dom-节点" class="table-of-contents__link toc-highlight">5.1 关注 Detached DOM 节点</a></li><li><a href="#52-分析高保留大小的对象" class="table-of-contents__link toc-highlight">5.2 分析高保留大小的对象</a></li><li><a href="#53-对比多个堆快照" class="table-of-contents__link toc-highlight">5.3 对比多个堆快照</a></li></ul></li><li><a href="#6-解决内存泄漏" class="table-of-contents__link toc-highlight">6. 解决内存泄漏</a><ul><li><a href="#61-移除不必要的事件监听器" class="table-of-contents__link toc-highlight">6.1 移除不必要的事件监听器</a></li><li><a href="#62-清理闭包中的引用" class="table-of-contents__link toc-highlight">6.2 清理闭包中的引用</a></li><li><a href="#63-正确管理全局变量" class="table-of-contents__link toc-highlight">6.3 正确管理全局变量</a></li><li><a href="#64-使用现代框架的生命周期管理" class="table-of-contents__link toc-highlight">6.4 使用现代框架的生命周期管理</a></li></ul></li><li><a href="#7-验证修复" class="table-of-contents__link toc-highlight">7. 验证修复</a><ul><li><a href="#步骤-1" class="table-of-contents__link toc-highlight">步骤：</a></li></ul></li><li><a href="#8-最佳实践" class="table-of-contents__link toc-highlight">8. 最佳实践</a><ul><li><a href="#81-定期监控内存使用" class="table-of-contents__link toc-highlight">8.1 定期监控内存使用</a></li><li><a href="#82-遵循编码规范" class="table-of-contents__link toc-highlight">8.2 遵循编码规范</a></li><li><a href="#83-使用现代框架的资源管理功能" class="table-of-contents__link toc-highlight">8.3 使用现代框架的资源管理功能</a></li><li><a href="#84-使用弱引用" class="table-of-contents__link toc-highlight">8.4 使用弱引用</a></li><li><a href="#85-优化数据结构" class="table-of-contents__link toc-highlight">8.5 优化数据结构</a></li></ul></li><li><a href="#9-总结" class="table-of-contents__link toc-highlight">9. 总结</a><ul><li><a href="#场景描述" class="table-of-contents__link toc-highlight">场景描述</a></li><li><a href="#问题分析" class="table-of-contents__link toc-highlight">问题分析</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/iiLsss/iiLsss.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 地球, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0980ab72.js"></script>
<script src="/assets/js/main.63f0261d.js"></script>
</body>
</html>